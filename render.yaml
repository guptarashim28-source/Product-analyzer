services:
  - type: web
    name: product-analyzer
    env: python
    region: oregon
    plan: free
    rootDir: bl
    buildCommand: |
      # Install Python dependencies first
      pip install --upgrade pip
      pip install -r requirements.txt
      
      # Install Chrome dependencies for Debian/Ubuntu
      apt-get update
      apt-get install -y \
        wget \
        gnupg \
        unzip \
        curl \
        fonts-liberation \
        libasound2 \
        libatk-bridge2.0-0 \
        libatk1.0-0 \
        libatspi2.0-0 \
        libcups2 \
        libdbus-1-3 \
        libdrm2 \
        libgbm1 \
        libgtk-3-0 \
        libnspr4 \
        libnss3 \
        libwayland-client0 \
        libxcomposite1 \
        libxdamage1 \
        libxfixes3 \
        libxkbcommon0 \
        libxrandr2 \
        xdg-utils
      
      # Download and install Chrome
      wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
      dpkg -i google-chrome-stable_current_amd64.deb || apt-get install -fy
      rm -f google-chrome-stable_current_amd64.deb
      
      # Verify Chrome installation
      echo "Verifying Chrome installation..."
      which google-chrome
      google-chrome --version
      
      echo "Build complete!"
    startCommand: |
      cd amazon_blinkit_scrapping && python backend.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: GEMINI_API_KEY
        sync: false
      - key: NEWSAPI_KEY
        sync: false
      - key: BLINKIT_HEADLESS
        value: "1"
      - key: MANUAL_LOCATION_MODE
        value: "false"
      - key: CHROME_BIN
        value: "/usr/bin/google-chrome"
      - key: CHROMEDRIVER_PATH
        value: "/usr/bin/chromedriver"
